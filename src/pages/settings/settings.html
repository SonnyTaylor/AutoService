<section class="page" data-page="settings">
  <h1>Settings</h1>
  <p class="muted">Configure AutoService behavior.</p>

  <div class="settings-layout">
    <!-- Left sidebar navigation -->
    <aside class="card settings-sidebar">
      <div class="card-title">Sections</div>
      <nav id="settings-nav">
        <button class="shortcut-btn active" data-target="programs">
          Programs
        </button>
        <button class="shortcut-btn" data-target="technician">
          Technician
        </button>
        <button class="shortcut-btn" data-target="network">Network</button>
        <button class="shortcut-btn" data-target="ai">AI / API</button>
        <button class="shortcut-btn" data-target="business">Business</button>
        <button class="shortcut-btn" data-target="reports">Reports</button>
        <button class="shortcut-btn" data-target="task-times">Task Times</button>
        <button class="shortcut-btn" data-target="sentry">Sentry</button>
      </nav>
    </aside>

    <!-- Right content area -->
    <div id="settings-content">
      <!-- Programs pane -->
      <div class="card settings-pane" data-pane="programs">
        <div class="card-title">
          <span>Programs</span>
        </div>
        <div class="card-body">
          <p class="muted">
            Programs that are required by the automated service runner will show
            here. Add them in the programs section for them to be available in
            the service runner.
          </p>

          <!-- Required Tools Section -->
          <div class="programs-config-section">
            <div class="programs-section-header">
              <span class="programs-section-title">Required Tools</span>
              <span class="muted programs-section-subtitle">
                External tools required by service automation tasks
              </span>
            </div>
            <!-- Toolbar with search -->
            <div class="settings-toolbar">
              <input
                id="req-tools-search"
                class="shortcut-search"
                type="search"
                placeholder="Search required tools..."
                autocomplete="off"
              />
            </div>
            <div class="list" id="req-programs-list" aria-live="polite"></div>
          </div>
        </div>
      </div>
      <!-- Technician pane -->
      <div
        class="card settings-pane"
        data-pane="technician"
        style="display: none"
      >
        <div class="card-title"><span>Technician Links</span></div>
        <div class="card-body">
          <p class="muted">
            Add web tools you use frequently. They appear as tabs on the top
            bar. Data (cookies, localStorage) will persist on the USB via the
            app webview profile.
          </p>

          <!-- Add Link Section -->
          <div class="tech-links-config-section">
            <div class="tech-links-section-header">
              <span class="tech-links-section-title">Add New Link</span>
              <span class="muted tech-links-section-subtitle">
                Create a new technician link that will appear in the top bar
              </span>
            </div>
            <form id="tech-link-form" class="tech-links-toolbar">
              <label class="tech-input-title">
                <span class="muted">Title</span>
                <input
                  type="text"
                  name="title"
                  placeholder="e.g., Password Reset"
                  required
                  autocomplete="off"
                />
              </label>
              <label class="tech-input-url">
                <span class="muted">URL</span>
                <input
                  type="url"
                  name="url"
                  placeholder="https://..."
                  required
                  autocomplete="off"
                />
              </label>
              <button type="submit" class="primary">Add</button>
            </form>
          </div>

          <!-- Links List Section -->
          <div class="tech-links-list-section">
            <div class="tech-links-section-header">
              <span class="tech-links-section-title">Saved Links</span>
              <span class="muted tech-links-section-subtitle">
                Manage your technician links
              </span>
            </div>
            <div class="list" id="tech-links-list" aria-live="polite"></div>
          </div>
          <dialog id="tech-link-editor" class="program-editor">
            <form method="dialog" id="tech-link-edit-form">
              <h3>Edit Link</h3>
              <label>
                <span class="muted">Title</span>
                <input id="t-edit-title" type="text" required />
              </label>
              <label>
                <span class="muted">URL</span>
                <input id="t-edit-url" type="url" required />
              </label>
              <div class="dialog-actions">
                <button type="button" id="t-edit-cancel" class="ghost">
                  Cancel
                </button>
                <button type="submit" id="t-edit-save">Save</button>
              </div>
            </form>
          </dialog>
        </div>
      </div>

      <!-- Network pane (iperf, ping) -->
      <div class="card settings-pane" data-pane="network" style="display: none">
        <div class="card-title"><span>Network</span></div>
        <div class="card-body">
          <p class="muted">
            Configure network test options used by diagnostics.
          </p>

          <!-- iPerf Settings -->
          <div class="network-config-section">
            <div class="network-section-header">
              <span class="network-section-title">iPerf Server</span>
              <span class="muted network-section-subtitle">
                Configure the iPerf server for network performance testing
              </span>
            </div>
            <form id="iperf-settings-form">
              <label>
                <span class="muted">iPerf Server IP/Host</span>
                <input
                  type="text"
                  name="iperf_server"
                  id="iperf-server-input"
                  placeholder="e.g., 192.168.0.34"
                  autocomplete="off"
                />
              </label>
            </form>
            <div id="iperf-settings-status"></div>
          </div>

          <!-- Ping Settings -->
          <div class="network-config-section">
            <div class="network-section-header">
              <span class="network-section-title">Ping Host</span>
              <span class="muted network-section-subtitle">
                Configure the default host for ping tests
              </span>
            </div>
            <form id="ping-settings-form">
              <label>
                <span class="muted">Ping Host</span>
                <input
                  type="text"
                  name="ping_host"
                  id="ping-host-input"
                  placeholder="e.g., 8.8.8.8"
                  autocomplete="off"
                />
              </label>
            </form>
            <div id="ping-settings-status"></div>
          </div>
        </div>
      </div>

      <!-- AI / API pane -->
      <div class="card settings-pane" data-pane="ai" style="display: none">
        <div class="card-title"><span>AI / API Configuration</span></div>
        <div class="card-body">
          <p class="muted">
            Configure AI provider and model for AI-powered features like the AI
            Startup Optimizer, Browser Notification Analysis, and Windows Update
            Error Analysis.
          </p>

          <!-- Provider & Model Selection Section -->
          <div class="ai-config-section">
            <div class="ai-section-header">
              <span class="ai-section-title">Provider & Model</span>
              <span class="muted ai-section-subtitle">
                Choose your AI provider and model
              </span>
            </div>
            <form id="ai-settings-form" class="ai-api-form">
              <div class="ai-form-row">
                <label class="ai-form-field">
                  <span class="muted">AI Provider</span>
                  <select
                    name="provider"
                    id="ai-provider-select"
                    class="ai-provider-select"
                  >
                    <option value="openai">OpenAI</option>
                    <option value="anthropic">Anthropic (Claude)</option>
                    <option value="groq">Groq</option>
                    <option value="xai">xAI (Grok)</option>
                    <option value="azure">Azure OpenAI</option>
                    <option value="google">Google (Vertex AI)</option>
                    <option value="ollama">Ollama (Local)</option>
                  </select>
                  <span class="muted field-hint">
                    Select your AI provider. LiteLLM handles the API translation.
                  </span>
                </label>

                <label class="ai-form-field">
                  <span class="muted">Model</span>
                  <select name="model" id="ai-model-select" class="ai-model-select">
                    <!-- Options populated dynamically based on provider -->
                  </select>
                  <span class="muted field-hint">
                    Select the AI model to use for analysis tasks.
                  </span>
                </label>
              </div>
            </form>
          </div>

          <!-- API Configuration Section -->
          <div class="ai-config-section">
            <div class="ai-section-header">
              <span class="ai-section-title">API Configuration</span>
              <span class="muted ai-section-subtitle">
                Enter your API credentials
              </span>
            </div>
            <div class="ai-api-config">
              <label class="ai-form-field">
                <span class="muted">API Key</span>
                <div class="ai-api-key-wrapper">
                  <input
                    type="password"
                    name="api_key"
                    id="ai-api-key-input"
                    placeholder="Enter your API key..."
                    autocomplete="off"
                    class="ai-api-key-input"
                  />
                  <button
                    type="button"
                    id="ai-api-key-clear-btn"
                    class="ghost ai-clear-btn"
                    title="Clear API key"
                  >
                    Clear
                  </button>
                </div>
                <span class="muted field-hint" id="ai-provider-hint">
                  Get your API key from the provider's website.
                </span>
              </label>

              <label
                id="ai-base-url-label"
                class="ai-form-field"
                style="display: none"
              >
                <span class="muted">Base URL (Optional)</span>
                <input
                  type="text"
                  name="base_url"
                  id="ai-base-url-input"
                  placeholder="http://localhost:11434"
                  autocomplete="off"
                  class="ai-base-url-input"
                />
                <span class="muted field-hint">
                  Custom API endpoint (e.g., for Ollama or self-hosted models).
                </span>
              </label>
            </div>
          </div>

          <div id="ai-settings-status"></div>
        </div>
      </div>

      <!-- Business pane (technician mode, logo, business name) -->
      <div
        class="card settings-pane"
        data-pane="business"
        style="display: none"
      >
        <div class="card-title"><span>Business Information</span></div>
        <div class="card-body">
          <p class="muted">
            Configure business branding for customer-facing reports and prints.
          </p>

          <!-- Technician Mode Toggle -->
          <label class="business-settings-toggle">
            <input type="checkbox" id="technician-mode-toggle" />
            <div class="toggle-text">
              <div class="toggle-title">Enable Technician Mode</div>
              <div class="muted toggle-description">
                Show business branding on customer reports and prints
              </div>
            </div>
          </label>

          <!-- Technician Names Section -->
          <div class="business-config-section">
            <div class="business-section-header">
              <span class="business-section-title">Technician Names</span>
              <span class="muted business-section-subtitle">
                Add technician names for quick selection when starting services
              </span>
            </div>
            <form id="technician-name-form" class="tech-name-form">
              <input
                type="text"
                id="technician-name-input"
                placeholder="Enter technician name..."
                autocomplete="off"
                class="tech-name-input"
              />
              <button type="submit" class="primary">Add</button>
            </form>
            <div id="technician-names-list" class="list tech-names-list"></div>
          </div>

          <!-- Branding Category -->
          <div class="business-category" id="branding-category">
            <div class="business-category-title">Branding</div>
            <div class="fields-group">
              <!-- Business Logo -->
              <label
                id="business-logo-label"
                class="business-field business-logo-field"
              >
                <span class="muted">Business Logo</span>
                <div class="business-logo-input-row">
                  <input
                    type="text"
                    id="business-logo-input"
                    name="business_logo"
                    placeholder="Click Browse to select an image file..."
                    autocomplete="off"
                    readonly
                  />
                  <button
                    type="button"
                    id="business-logo-browse-btn"
                    class="ghost"
                  >
                    Browse...
                  </button>
                </div>
                <span class="muted field-hint">
                  Select any image file - it will be embedded in settings
                </span>
              </label>

              <!-- Business Name -->
              <label id="business-name-label" class="business-field">
                <span class="muted">Business Name</span>
                <input
                  type="text"
                  id="business-name-input"
                  name="business_name"
                  placeholder="e.g., Tech Solutions LLC"
                  autocomplete="off"
                />
                <span class="muted field-hint">
                  Your business name will appear on customer reports
                </span>
              </label>
            </div>
          </div>

          <!-- Contact Information Category -->
          <div class="business-category" id="contact-category">
            <div class="business-category-title">Contact Information</div>
            <div class="fields-group">
              <!-- Business Address -->
              <label id="business-address-label" class="business-field">
                <span class="muted">Business Address</span>
                <input
                  type="text"
                  id="business-address-input"
                  name="business_address"
                  placeholder="e.g., 42 Test Avenue, Exampleville VIC 3000"
                  autocomplete="off"
                />
              </label>

              <!-- Business Phone -->
              <label id="business-phone-label" class="business-field">
                <span class="muted">Phone Number</span>
                <input
                  type="text"
                  id="business-phone-input"
                  name="business_phone"
                  placeholder="e.g., 03 9123 4567"
                  autocomplete="off"
                />
              </label>

              <!-- Business Email -->
              <label id="business-email-label" class="business-field">
                <span class="muted">Email Address</span>
                <input
                  type="email"
                  id="business-email-input"
                  name="business_email"
                  placeholder="e.g., admin@techrepairs.com.au"
                  autocomplete="off"
                />
              </label>

              <!-- Business Website -->
              <label id="business-website-label" class="business-field">
                <span class="muted">Website</span>
                <input
                  type="text"
                  id="business-website-input"
                  name="business_website"
                  placeholder="e.g., www.techrepairs.com.au"
                  autocomplete="off"
                />
              </label>
            </div>
          </div>

          <!-- Business Identification Category -->
          <div class="business-category" id="identification-category">
            <div class="business-category-title">Business Identification</div>
            <div class="fields-group">
              <!-- Business TFN -->
              <label id="business-tfn-label" class="business-field">
                <span class="muted">TFN (Tax File Number)</span>
                <input
                  type="text"
                  id="business-tfn-input"
                  name="business_tfn"
                  placeholder="e.g., 123 456 789"
                  autocomplete="off"
                />
              </label>

              <!-- Business ABN -->
              <label id="business-abn-label" class="business-field">
                <span class="muted">ABN (Australian Business Number)</span>
                <input
                  type="text"
                  id="business-abn-input"
                  name="business_abn"
                  placeholder="e.g., 12 345 678 901"
                  autocomplete="off"
                />
              </label>
            </div>
          </div>

          <div id="business-settings-status" class="muted"></div>
        </div>
      </div>

      <!-- Reports pane -->
      <div class="card settings-pane" data-pane="reports" style="display: none">
        <div class="card-title"><span>Reports</span></div>
        <div class="card-body">
          <p class="muted">Configure report saving behavior and preferences.</p>

          <!-- Report Saving Section -->
          <div class="reports-config-section">
            <div class="reports-section-header">
              <span class="reports-section-title">Report Saving</span>
              <span class="muted reports-section-subtitle">
                Configure how reports are saved automatically
              </span>
            </div>
            <div class="reports-toggles-group">
              <label class="business-settings-toggle">
                <input type="checkbox" id="reports-autosave-toggle" />
                <div class="toggle-text">
                  <div class="toggle-title">Auto-save Reports</div>
                  <div class="muted toggle-description">
                    Automatically save reports after every service completes (no
                    need to manually click Save Report)
                  </div>
                </div>
              </label>
            </div>
          </div>

          <!-- Notifications Section -->
          <div class="reports-config-section">
            <div class="reports-section-header">
              <span class="reports-section-title">Notifications</span>
              <span class="muted reports-section-subtitle">
                Configure alerts when services complete
              </span>
            </div>
            <div class="reports-toggles-group">
              <label class="business-settings-toggle">
                <input type="checkbox" id="reports-notifications-toggle" />
                <div class="toggle-text">
                  <div class="toggle-title">Desktop Notifications</div>
                  <div class="muted toggle-description">
                    Show a system notification when a service run completes
                  </div>
                </div>
              </label>

              <!-- Completion Sound Toggle and Controls -->
              <label class="business-settings-toggle">
                <input type="checkbox" id="reports-sound-toggle" />
                <div class="toggle-text">
                  <div class="toggle-title">Play Sound on Completion</div>
                  <div class="muted toggle-description">
                    Plays a tone sequence when a service finishes to get your
                    attention
                  </div>
                  <div class="sound-controls">
                    <div class="sound-control-row">
                      <label for="reports-sound-volume" class="sound-control-label">
                        Volume
                      </label>
                      <input
                        type="range"
                        id="reports-sound-volume"
                        min="0"
                        max="100"
                        step="1"
                        value="80"
                        aria-label="Completion sound volume"
                        class="sound-volume-slider"
                      />
                      <span id="reports-sound-volume-label" class="sound-volume-value">
                        80%
                      </span>
                    </div>
                    <div class="sound-control-row">
                      <label for="reports-sound-select" class="sound-control-label">
                        Sound
                      </label>
                      <select
                        id="reports-sound-select"
                        aria-label="Notification sound"
                        class="sound-select"
                      >
                        <option value="classic-beep">Classic Beep</option>
                      </select>
                    </div>
                    <div class="sound-control-row">
                      <label for="reports-sound-repeat" class="sound-control-label">
                        Repeat
                      </label>
                      <input
                        id="reports-sound-repeat"
                        type="number"
                        min="1"
                        max="10"
                        step="1"
                        value="1"
                        aria-label="How many times to play the sound"
                        class="sound-repeat-input"
                      />
                      <button
                        type="button"
                        id="reports-sound-test-btn"
                        class="ghost sound-test-btn"
                        title="Test the selected sound"
                      >
                        <i class="ph ph-speaker-high" aria-hidden="true"></i>
                        <span>Test</span>
                      </button>
                    </div>
                  </div>
                </div>
              </label>
            </div>
            <div id="reports-settings-status" class="muted"></div>
          </div>

          <!-- Network Sharing Section -->
          <div class="reports-config-section">
            <div class="reports-section-header">
              <span class="reports-section-title">Network Sharing</span>
              <span class="muted reports-section-subtitle">
                Share reports across your network
              </span>
            </div>
            <div class="reports-toggles-group">
              <label class="business-settings-toggle">
                <input type="checkbox" id="network-sharing-toggle" />
                <div class="toggle-text">
                  <div class="toggle-title">Enable network report sharing</div>
                  <div class="muted toggle-description">
                    Copy saved reports to a network share (UNC path)
                  </div>
                </div>
              </label>
            </div>
            <div class="network-sharing-form-group">
              <form id="network-sharing-form">
                <label>
                  <span class="muted">Network UNC Path</span>
                  <input
                    type="text"
                    id="network-unc-input"
                    placeholder="\\\\192.168.1.100\\share\\reports"
                    autocomplete="off"
                  />
                </label>

                <div class="network-save-modes">
                  <span class="muted">Save to</span>
                  <div class="radio-group">
                    <label class="radio-option">
                      <input
                        type="radio"
                        name="network-save-mode"
                        id="network-save-local"
                        value="local"
                      />
                      <span>Local only</span>
                    </label>
                    <label class="radio-option">
                      <input
                        type="radio"
                        name="network-save-mode"
                        id="network-save-network"
                        value="network"
                      />
                      <span>Network only</span>
                    </label>
                    <label class="radio-option">
                      <input
                        type="radio"
                        name="network-save-mode"
                        id="network-save-both"
                        value="both"
                        checked
                      />
                      <span>Both (recommended)</span>
                    </label>
                  </div>
                  <button type="button" id="network-test-btn" class="ghost">
                    <i class="ph ph-plug-charging"></i> Test Connection
                  </button>
                </div>
              </form>

              <div id="network-sharing-status"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sentry pane -->
      <!-- Task Time Estimates pane -->
      <div class="card settings-pane" data-pane="task-times" style="display: none">
        <div class="card-title"><span>Task Time Estimates</span></div>
        <div class="card-body">
          <p class="muted">
            Task time estimates are calculated from historical execution data to help predict how long service runs will take.
            Estimates require at least 3 successful runs per task configuration before being displayed.
          </p>

          <!-- Statistics Section -->
          <div class="task-times-config-section">
            <div class="task-times-section-header">
              <span class="task-times-section-title">Statistics</span>
              <span class="muted task-times-section-subtitle">
                Overview of stored task time records
              </span>
            </div>

            <div id="task-times-stats" class="task-times-stats-grid">
              <div class="task-times-stat-card">
                <div class="task-times-stat-label">Total Records</div>
                <div class="task-times-stat-value" id="task-times-total">Loading...</div>
              </div>
              <div class="task-times-stat-card">
                <div class="task-times-stat-label">Unique Task Types</div>
                <div class="task-times-stat-value" id="task-times-unique">Loading...</div>
              </div>
              <div class="task-times-stat-card">
                <div class="task-times-stat-label">Oldest Record</div>
                <div class="task-times-stat-value" id="task-times-oldest">Loading...</div>
              </div>
              <div class="task-times-stat-card">
                <div class="task-times-stat-label">Newest Record</div>
                <div class="task-times-stat-value" id="task-times-newest">Loading...</div>
              </div>
            </div>
          </div>

          <!-- Data Management Section -->
          <div class="task-times-config-section">
            <div class="task-times-section-header">
              <span class="task-times-section-title">Data Management</span>
              <span class="muted task-times-section-subtitle">
                Clear all stored task time estimates
              </span>
            </div>

            <div class="task-times-actions">
              <button id="task-times-clear-btn" class="task-times-clear-btn">
                <i class="ph ph-trash" aria-hidden="true"></i>
                <span>Clear All Estimates</span>
              </button>
              <p class="muted small task-times-warning">
                This will permanently delete all task time records. Estimates will need to be rebuilt from future runs.
              </p>
            </div>
            <div id="task-times-settings-status" class="muted"></div>
          </div>
        </div>
      </div>

      <div class="card settings-pane" data-pane="sentry" style="display: none">
        <div class="card-title"><span>Sentry Error Tracking</span></div>
        <div class="card-body">
          <p class="muted">
            Configure error tracking and performance monitoring for the Python
            service runner. These settings help improve AutoService by reporting
            errors and performance data to Sentry.
          </p>

          <!-- Master Toggle Section -->
          <div class="sentry-config-section">
            <div class="sentry-section-header">
              <span class="sentry-section-title">Enable Sentry</span>
              <span class="muted sentry-section-subtitle">
                Master toggle to enable/disable all error tracking and
                performance monitoring
              </span>
            </div>
            <label class="business-settings-toggle">
              <input type="checkbox" id="sentry-enabled-toggle" />
              <div class="toggle-text">
                <div class="toggle-title">Enable Sentry</div>
                <div class="muted toggle-description">
                  Master toggle to enable/disable all error tracking and
                  performance monitoring
                </div>
              </div>
            </label>
          </div>

          <!-- Configuration Section -->
          <div class="sentry-config-section">
            <div class="sentry-section-header">
              <span class="sentry-section-title">Configuration</span>
              <span class="muted sentry-section-subtitle">
                Configure environment and data collection settings
              </span>
            </div>
            <div class="sentry-config-group">
              <label class="sentry-environment-label">
                <span class="muted">Environment</span>
                <select
                  id="sentry-environment-select"
                  aria-label="Sentry environment"
                >
                  <option value="production">Production</option>
                  <option value="development">Development</option>
                  <option value="staging">Staging</option>
                </select>
                <span class="muted field-hint">
                  Select the environment for error tracking and performance
                  monitoring
                </span>
              </label>
            </div>
          </div>

          <!-- Data Collection Section -->
          <div class="sentry-config-section">
            <div class="sentry-section-header">
              <span class="sentry-section-title">Data Collection</span>
              <span class="muted sentry-section-subtitle">
                Control what information is included in error reports
              </span>
            </div>
            <div class="sentry-toggles-group">
              <label class="business-settings-toggle">
                <input type="checkbox" id="sentry-pii-toggle" />
                <div class="toggle-text">
                  <div class="toggle-title">Send PII Data</div>
                  <div class="muted toggle-description">
                    Include hostname and username in error reports (helps identify
                    which PC had issues)
                  </div>
                </div>
              </label>

              <label class="business-settings-toggle">
                <input type="checkbox" id="sentry-performance-toggle" />
                <div class="toggle-text">
                  <div class="toggle-title">Performance Monitoring</div>
                  <div class="muted toggle-description">
                    Enable transaction and trace sampling to track performance
                    metrics
                  </div>
                </div>
              </label>

              <label class="business-settings-toggle">
                <input type="checkbox" id="sentry-system-info-toggle" />
                <div class="toggle-text">
                  <div class="toggle-title">System Information</div>
                  <div class="muted toggle-description">
                    Include system information (CPU, memory, disk) in error reports
                  </div>
                </div>
              </label>
            </div>
            <div id="sentry-settings-status" class="muted"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Page logic handled by settings.js controller (initPage) -->
</section>
