<section class="page" data-page="settings">
  <h1>Settings</h1>
  <p class="muted">Configure AutoService behavior.</p>

  <div class="settings-layout">
    <!-- Left sidebar navigation -->
    <aside class="card settings-sidebar">
      <div class="card-title">Sections</div>
      <nav id="settings-nav">
        <button class="shortcut-btn active" data-target="programs">
          Programs
        </button>
        <button class="shortcut-btn" data-target="technician">
          Technician
        </button>
        <button class="shortcut-btn" data-target="network">Network</button>
        <button class="shortcut-btn" data-target="ai">AI / API</button>
        <button class="shortcut-btn" data-target="business">Business</button>
        <button class="shortcut-btn" data-target="reports">Reports</button>
      </nav>
    </aside>

    <!-- Right content area -->
    <div id="settings-content">
      <!-- Programs pane -->
      <div class="card settings-pane" data-pane="programs">
        <div class="card-title">
          <span>Programs</span>
        </div>
        <div class="card-body">
          <p class="muted">
            Programs that are required by the automated service runner will show
            here. Add them in the programs section for them to be available in
            the service runner.
          </p>

          <!-- Toolbar with search -->
          <div class="settings-toolbar">
            <input
              id="req-tools-search"
              class="shortcut-search"
              type="search"
              placeholder="Search required tools..."
              autocomplete="off"
            />
          </div>

          <div class="list" id="req-programs-list" aria-live="polite"></div>
        </div>
      </div>
      <!-- Technician pane -->
      <div
        class="card settings-pane"
        data-pane="technician"
        style="display: none"
      >
        <div class="card-title"><span>Technician Links</span></div>
        <div class="card-body">
          <p class="muted">
            Add web tools you use frequently. They appear as tabs on the top
            bar. Data (cookies, localStorage) will persist on the USB via the
            app webview profile.
          </p>

          <!-- Toolbar-style form -->
          <form id="tech-link-form" class="tech-links-toolbar">
            <label class="tech-input-title">
              <span class="muted">Title</span>
              <input
                type="text"
                name="title"
                placeholder="e.g., Password Reset"
                required
                autocomplete="off"
              />
            </label>
            <label class="tech-input-url">
              <span class="muted">URL</span>
              <input
                type="url"
                name="url"
                placeholder="https://..."
                required
                autocomplete="off"
              />
            </label>
            <button type="submit" class="primary">Add</button>
          </form>

          <div class="list" id="tech-links-list" aria-live="polite"></div>
          <dialog id="tech-link-editor" class="program-editor">
            <form method="dialog" id="tech-link-edit-form">
              <h3>Edit Link</h3>
              <label>
                <span class="muted">Title</span>
                <input id="t-edit-title" type="text" required />
              </label>
              <label>
                <span class="muted">URL</span>
                <input id="t-edit-url" type="url" required />
              </label>
              <div class="dialog-actions">
                <button type="button" id="t-edit-cancel" class="ghost">
                  Cancel
                </button>
                <button type="submit" id="t-edit-save">Save</button>
              </div>
            </form>
          </dialog>
        </div>
      </div>

      <!-- Network pane (iperf, ping) -->
      <div class="card settings-pane" data-pane="network" style="display: none">
        <div class="card-title"><span>Network</span></div>
        <div class="card-body">
          <p class="muted">
            Configure network test options used by diagnostics.
          </p>

          <!-- iPerf Settings -->
          <div class="network-form-group">
            <form id="iperf-settings-form">
              <label>
                <span class="muted">iPerf Server IP/Host</span>
                <input
                  type="text"
                  name="iperf_server"
                  id="iperf-server-input"
                  placeholder="e.g., 192.168.0.34"
                  autocomplete="off"
                />
              </label>
              <button type="submit" class="primary">Save</button>
            </form>
            <div id="iperf-settings-status"></div>
          </div>

          <hr />

          <!-- Ping Settings -->
          <div class="network-form-group">
            <form id="ping-settings-form">
              <label>
                <span class="muted">Ping Host</span>
                <input
                  type="text"
                  name="ping_host"
                  id="ping-host-input"
                  placeholder="e.g., 8.8.8.8"
                  autocomplete="off"
                />
              </label>
              <button type="submit" class="primary">Save</button>
            </form>
            <div id="ping-settings-status"></div>
          </div>
        </div>
      </div>

      <!-- AI / API pane -->
      <div class="card settings-pane" data-pane="ai" style="display: none">
        <div class="card-title"><span>AI / API Keys</span></div>
        <div class="card-body">
          <p class="muted">
            Configure API keys for AI-powered features like the AI Startup
            Optimizer.
          </p>

          <!-- OpenAI API Key -->
          <form id="openai-settings-form" class="ai-api-form">
            <label>
              <span class="muted">OpenAI API Key</span>
              <div style="display: flex; gap: 8px; align-items: flex-end">
                <input
                  type="password"
                  name="openai_api_key"
                  id="openai-api-key-input"
                  placeholder="sk-proj-..."
                  autocomplete="off"
                  style="flex: 1"
                />
                <button type="submit" class="primary">Save</button>
                <button
                  type="button"
                  id="openai-api-key-clear-btn"
                  class="ghost"
                >
                  Clear
                </button>
              </div>
              <span class="muted field-hint">
                Required for AI Startup Optimizer. Get your API key from
                <a
                  href="https://platform.openai.com/api-keys"
                  target="_blank"
                  rel="noopener"
                  >platform.openai.com</a
                >
              </span>
            </label>
          </form>
          <div id="openai-settings-status"></div>
        </div>
      </div>

      <!-- Business pane (technician mode, logo, business name) -->
      <div
        class="card settings-pane"
        data-pane="business"
        style="display: none"
      >
        <div class="card-title"><span>Business Information</span></div>
        <div class="card-body">
          <p class="muted">
            Configure business branding for customer-facing reports and prints.
          </p>

          <!-- Technician Mode Toggle -->
          <label class="business-settings-toggle">
            <input type="checkbox" id="technician-mode-toggle" />
            <div class="toggle-text">
              <div class="toggle-title">Enable Technician Mode</div>
              <div class="muted toggle-description">
                Show business branding on customer reports and prints
              </div>
            </div>
          </label>

          <hr />

          <!-- Technician Names Management -->
          <div id="technician-names-section" class="business-field">
            <span class="muted">Technician Names</span>
            <p class="muted" style="font-size: 0.9rem; margin: 4px 0 12px 0">
              Add technician names for quick selection when starting services
            </p>

            <form
              id="technician-name-form"
              style="display: flex; gap: 8px; margin-bottom: 12px"
            >
              <input
                type="text"
                id="technician-name-input"
                placeholder="Enter technician name..."
                autocomplete="off"
                style="flex: 1"
              />
              <button type="submit" class="primary">Add</button>
            </form>

            <div
              id="technician-names-list"
              class="list"
              style="margin-top: 12px"
            ></div>
          </div>

          <hr />

          <!-- Business Logo -->
          <label
            id="business-logo-label"
            class="business-field business-logo-field"
          >
            <span class="muted">Business Logo</span>
            <div class="business-logo-input-row">
              <input
                type="text"
                id="business-logo-input"
                name="business_logo"
                placeholder="Click Browse to select an image file..."
                autocomplete="off"
                readonly
              />
              <button type="button" id="business-logo-browse-btn" class="ghost">
                Browse...
              </button>
            </div>
            <span class="muted field-hint">
              Select any image file from anywhere on your computer - it will be
              embedded in settings
            </span>
          </label>

          <!-- Business Name -->
          <label id="business-name-label" class="business-field">
            <span class="muted">Business Name</span>
            <input
              type="text"
              id="business-name-input"
              name="business_name"
              placeholder="e.g. Tech Solutions LLC"
              autocomplete="off"
            />
            <span class="muted field-hint">
              Your business name will appear on customer reports
            </span>
          </label>

          <!-- Business Address -->
          <label id="business-address-label" class="business-field">
            <span class="muted">Business Address</span>
            <input
              type="text"
              id="business-address-input"
              name="business_address"
              placeholder="e.g. 42 Test Avenue, Exampleville VIC 3000"
              autocomplete="off"
            />
          </label>

          <!-- Business Phone -->
          <label id="business-phone-label" class="business-field">
            <span class="muted">Phone Number</span>
            <input
              type="text"
              id="business-phone-input"
              name="business_phone"
              placeholder="e.g. 03 9123 4567"
              autocomplete="off"
            />
          </label>

          <!-- Business Email -->
          <label id="business-email-label" class="business-field">
            <span class="muted">Email Address</span>
            <input
              type="email"
              id="business-email-input"
              name="business_email"
              placeholder="e.g. admin@techrepairs.com.au"
              autocomplete="off"
            />
          </label>

          <!-- Business Website -->
          <label id="business-website-label" class="business-field">
            <span class="muted">Website</span>
            <input
              type="text"
              id="business-website-input"
              name="business_website"
              placeholder="e.g. www.techrepairs.com.au"
              autocomplete="off"
            />
          </label>

          <!-- Business TFN -->
          <label id="business-tfn-label" class="business-field">
            <span class="muted">TFN (Tax File Number)</span>
            <input
              type="text"
              id="business-tfn-input"
              name="business_tfn"
              placeholder="e.g. 123 456 789"
              autocomplete="off"
            />
          </label>

          <!-- Business ABN -->
          <label id="business-abn-label" class="business-field">
            <span class="muted">ABN (Australian Business Number)</span>
            <input
              type="text"
              id="business-abn-input"
              name="business_abn"
              placeholder="e.g. 12 345 678 901"
              autocomplete="off"
            />
          </label>

          <!-- Save Button -->
          <div class="business-settings-actions">
            <button type="button" id="business-settings-save" class="primary">
              Save Business Settings
            </button>
            <div id="business-settings-status" class="muted"></div>
          </div>
        </div>
      </div>

      <!-- Reports pane -->
      <div class="card settings-pane" data-pane="reports" style="display: none">
        <div class="card-title"><span>Reports</span></div>
        <div class="card-body">
          <p class="muted">Configure report saving behavior and preferences.</p>

          <!-- Auto-save Toggle -->
          <label class="business-settings-toggle">
            <input type="checkbox" id="reports-autosave-toggle" />
            <div class="toggle-text">
              <div class="toggle-title">Auto-save Reports</div>
              <div class="muted toggle-description">
                Automatically save reports after every service completes (no
                need to manually click Save Report)
              </div>
            </div>
          </label>

          <hr />

          <!-- Desktop Notifications Toggle -->
          <label class="business-settings-toggle">
            <input type="checkbox" id="reports-notifications-toggle" />
            <div class="toggle-text">
              <div class="toggle-title">Desktop Notifications</div>
              <div class="muted toggle-description">
                Show a system notification when a service run completes
              </div>
            </div>
          </label>

          <hr />

          <!-- Completion Sound Toggle and Volume -->
          <label class="business-settings-toggle">
            <input type="checkbox" id="reports-sound-toggle" />
            <div class="toggle-text">
              <div class="toggle-title">Play Sound on Completion</div>
              <div class="muted toggle-description">
                Plays a tone sequence when a service finishes to get your
                attention
              </div>
              <div
                style="
                  display: flex;
                  align-items: center;
                  gap: 10px;
                  margin-top: 8px;
                  flex-wrap: wrap;
                "
              >
                <label
                  for="reports-sound-volume"
                  class="muted"
                  style="min-width: 70px"
                  >Volume</label
                >
                <input
                  type="range"
                  id="reports-sound-volume"
                  min="0"
                  max="100"
                  step="1"
                  value="80"
                  aria-label="Completion sound volume"
                />
                <span
                  id="reports-sound-volume-label"
                  class="muted"
                  style="width: 42px; text-align: right"
                  >80%</span
                >

                <label
                  for="reports-sound-select"
                  class="muted"
                  style="min-width: 60px; margin-left: auto"
                  >Sound</label
                >
                <select
                  id="reports-sound-select"
                  aria-label="Notification sound"
                  style="flex: 1; min-width: 160px; max-width: 260px"
                >
                  <option value="classic-beep">Classic Beep</option>
                </select>

                <label
                  for="reports-sound-repeat"
                  class="muted"
                  style="min-width: 60px"
                  >Repeat</label
                >
                <input
                  id="reports-sound-repeat"
                  type="number"
                  min="1"
                  max="10"
                  step="1"
                  value="1"
                  aria-label="How many times to play the sound"
                  style="width: 70px"
                />

                <button
                  type="button"
                  id="reports-sound-test-btn"
                  class="ghost"
                  title="Test the selected sound"
                >
                  <i class="ph ph-speaker-high" aria-hidden="true"></i>
                  <span>Test</span>
                </button>
              </div>
            </div>
          </label>

          <div id="reports-settings-status" class="muted"></div>

          <hr />

          <!-- Network Report Sharing -->
          <label class="business-settings-toggle">
            <input type="checkbox" id="network-sharing-toggle" />
            <div class="toggle-text">
              <div class="toggle-title">Enable network report sharing</div>
              <div class="muted toggle-description">
                Copy saved reports to a network share (UNC path)
              </div>
            </div>
          </label>

          <div class="network-form-group">
            <form id="network-sharing-form">
              <label>
                <span class="muted">Network UNC Path</span>
                <input
                  type="text"
                  id="network-unc-input"
                  placeholder="\\\\192.168.1.100\\share\\reports"
                  autocomplete="off"
                />
              </label>

              <div class="network-save-modes">
                <span class="muted">Save to</span>
                <div class="radio-group">
                  <label class="radio-option">
                    <input
                      type="radio"
                      name="network-save-mode"
                      id="network-save-local"
                      value="local"
                    />
                    <span>Local only</span>
                  </label>
                  <label class="radio-option">
                    <input
                      type="radio"
                      name="network-save-mode"
                      id="network-save-network"
                      value="network"
                    />
                    <span>Network only</span>
                  </label>
                  <label class="radio-option">
                    <input
                      type="radio"
                      name="network-save-mode"
                      id="network-save-both"
                      value="both"
                      checked
                    />
                    <span>Both (recommended)</span>
                  </label>
                </div>
                <button type="button" id="network-test-btn" class="ghost">
                  <i class="ph ph-plug-charging"></i> Test Connection
                </button>
              </div>
            </form>

            <div
              id="network-sharing-status"
              class="muted"
              style="margin-top: 8px"
            ></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Page logic handled by settings.js controller (initPage) -->
</section>
